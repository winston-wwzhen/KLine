<!--pages/index/index.wxml-->
<view class="container">
  <!-- é€‰æ‹©å™¨åŒºåŸŸ -->
  <view class="selectors-section">
    <view class="selectors-row">
      <!-- åŸå¸‚é€‰æ‹©å™¨ -->
      <view class="city-selector">
        <picker mode="selector" range="{{cities}}" range-key="name" bindchange="onCityChange">
          <view class="picker">
            <text class="label">åŸå¸‚</text>
            <text class="city-name">{{selectedCityName}}</text>
          </view>
        </picker>
      </view>

      <!-- æ˜¾ç¤ºæ¨¡å¼é€‰æ‹©å™¨ -->
      <view class="mode-selector">
        <picker mode="selector" range="{{displayModes}}" range-key="label" bindchange="onModeChange">
          <view class="picker">
            <text class="label">æ¨¡å¼</text>
            <text class="mode-label">{{displayModeLabel}}</text>
          </view>
        </picker>
      </view>
    </view>
  </view>

  <!-- æ¨¡å¼è¯´æ˜ -->
  <view class="mode-desc-card">
    <text class="mode-desc-text">{{modeDesc}}</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯æç¤º -->
  <view wx:if="{{errorMsg}}" class="error">
    <text>{{errorMsg}}</text>
  </view>

  <!-- Kçº¿å›¾å®¹å™¨ -->
  <view wx:if="{{!loading && !errorMsg}}" class="chart-container">
    <kline-chart klineData="{{klineData}}" displayMode="{{displayMode}}"></kline-chart>
  </view>

  <!-- å›¾ä¾‹è¯´æ˜ -->
  <view class="legend">
    <view class="legend-item">
      <view class="color-box up"></view>
      <text>çº¢è‰²ï¼šä¸Šæ¶¨</text>
    </view>
    <view class="legend-item">
      <view class="color-box down"></view>
      <text>ç»¿è‰²ï¼šä¸‹è·Œ</text>
    </view>
  </view>

  <!-- AIåˆ†ææŒ‰é’® -->
  <view wx:if="{{!loading && !errorMsg && klineData.length > 0}}" class="analyze-section">
    <button class="analyze-btn" bindtap="onGenerateReport" disabled="{{analyzing}}">
      <text wx:if="{{!analyzing}}">âœ¨ AIç”Ÿæˆåˆ†ææŠ¥å‘Š</text>
      <text wx:else="{{analyzing}}">ğŸ¤– åˆ†æä¸­...</text>
    </button>
  </view>

  <!-- AIåˆ†ææŠ¥å‘Š -->
  <view wx:if="{{analysisReport}}" class="report-card">
    <view class="report-header">
      <text class="report-title">ğŸ“Š {{selectedCityName}}å¹´åº¦æ¸©åº¦Kçº¿åˆ†ææŠ¥å‘Š</text>
      <text class="report-mode">{{displayModeLabel}}æ¨¡å¼</text>
    </view>
    <view class="report-content">
      <text class="report-text">{{analysisReport}}</text>
    </view>
    <view class="report-footer">
      <text class="report-time">ç”Ÿæˆæ—¶é—´ï¼š{{reportTime}}</text>
    </view>
    <!-- åˆ†äº«æŒ‰é’® -->
    <view class="share-section">
      <button class="share-btn" bindtap="onShareReport" open-type="share">
        <text>ğŸ“± åˆ†äº«ç»™å¥½å‹</text>
      </button>
    </view>
  </view>
</view>
